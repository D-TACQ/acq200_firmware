#!/usr/bin/perl

use strict;

sub cook_file {
	my ($file) = @_;
	my ($root) = $file =~ /(\S+)\..*$/;
	my $cooked = $root.'.c';
	
	open IN, "$file" or die "ERROR failed to open $file\n";
	open OUT, ">$cooked" or die "ERROR failed to open $cooked\n";

	$root =~ s/[-\.]/_/g;
	print OUT  
"/* $cooked autogenerated by cook_consts */\n".
"\n".
"struct ULL_LUT $root [] = {\n";

	while( <IN> ){
		my @fields = split;
		print OUT "{ \"$fields[1]\", $fields[1] },\n";
	}

	print OUT
"{ 0},\n".
"};\n".
"\n".
"/** End of File */\n";
	close IN;
	close OUT;
}


sub make_test_data {
# make a test data set. join 8 lines at a time to test keyword OR ing

	my ($file) = @_;
	my ($root) = $file =~ /(\S+)\..*$/;
	my $data = $root.'.dat';
	
	open IN, "$file" or die "ERROR failed to open $file\n";
	open OUT, ">$data" or die "ERROR failed to open $data\n";

	$root =~ s/[-\.]/_/g;
	print OUT  "# $data autogen by cook_consts from $file\n";

	my $fn = 0;
	while( <IN> ){
		my $sep = ++$fn%8 == 0? "\n": " ";
		my @fields = split;
		print OUT "$fields[1]$sep";		
	}
	
	print OUT "\n# End of File\n";
	close IN;
	close OUT;
}


cook_file( 'M2-consts.h' );
cook_file( 'M5-consts.h' );

make_test_data( 'M2-consts.h' );
make_test_data( 'M5-consts.h' );

